# SELVE Chatbot Backend Environment Configuration
# Copy this file to .env and fill in your actual values
# For production deployment, change ENVIRONMENT to 'production'

# ==============================================================================
# ENVIRONMENT CONTROL
# ==============================================================================
# Switch between development and production
# development: Uses localhost URLs, dev keys, and dev database
# production: Uses production domains, live keys, and prod database
ENVIRONMENT=development

# Base app URLs (used for assessment CTA links and cross-app redirects)
MAIN_APP_URL_DEV=http://localhost:3000
MAIN_APP_URL_PROD=https://selve.me
# Optional explicit assessment override; if unset, we append /assessment to MAIN_APP_URL
# ASSESSMENT_URL=https://selve.me/assessment

# ==============================================================================
# LLM PROVIDER CONFIGURATION (Environment-based)
# ==============================================================================

# Primary LLM Provider: Anthropic Claude
LLM_PROVIDER=anthropic
ANTHROPIC_MODEL=claude-haiku-4-5

# Anthropic API Keys
ANTHROPIC_API_KEY_DEV=your_anthropic_dev_key_here
ANTHROPIC_API_KEY_PROD=your_anthropic_prod_key_here

# Active key (auto-selected based on ENVIRONMENT)
ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY_DEV}

# OpenAI API Keys (for embeddings, compression, and fallback)
OPENAI_API_KEY_DEV=your_openai_dev_key_here
OPENAI_API_KEY_PROD=your_openai_prod_key_here

# Active key (auto-selected based on ENVIRONMENT)
OPENAI_API_KEY=${OPENAI_API_KEY_DEV}

# ==============================================================================
# TIERED MODEL ROUTING
# ==============================================================================
ENABLE_AUTO_UPGRADE=false
COMPLEXITY_THRESHOLD=0.7

TIER_1_MODEL=claude-haiku-4-5
TIER_2_MODEL=claude-sonnet-4-5
TIER_3_MODEL=claude-opus-4-5
FALLBACK_MODEL=gpt-4o-mini

# ==============================================================================
# EMBEDDINGS & COMPRESSION
# ==============================================================================
EMBEDDING_MODEL=text-embedding-3-small
EMBEDDING_DIMENSION=1536
COMPRESSION_MODEL=gpt-4o-mini

# ==============================================================================
# DATABASE CONFIGURATION (Environment-based)
# ==============================================================================

# PostgreSQL (Neon - shared with main SELVE)
DATABASE_URL_DEV=postgresql://user:password@dev-host.neon.tech/selve_db?sslmode=require
DATABASE_URL_PROD=postgresql://user:password@prod-host.neon.tech/selve_db?sslmode=require

# Active database (auto-selected based on ENVIRONMENT)
DATABASE_URL=${DATABASE_URL_DEV}

# ==============================================================================
# REDIS CONFIGURATION (Working Memory Cache)
# ==============================================================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_TTL=3600

# ==============================================================================
# QDRANT CONFIGURATION (Vector Database)
# ==============================================================================
QDRANT_HOST=localhost
QDRANT_PORT=6333
QDRANT_API_KEY=
QDRANT_COLLECTION_NAME=selve_knowledge
QDRANT_VECTOR_SIZE=1536

# ==============================================================================
# API RETRY & FALLBACK CONFIGURATION
# ==============================================================================
MAX_RETRIES=3
INITIAL_RETRY_DELAY=2.0
ENABLE_FALLBACK=true
API_TIMEOUT=60

# ==============================================================================
# CLERK AUTHENTICATION & TOLL GATE (Environment-based)
# ==============================================================================

# Clerk public key for JWT verification
# Get from: Clerk Dashboard → API Keys → Show JWT public key
CLERK_PUBLIC_KEY=-----BEGIN PUBLIC KEY-----
your_clerk_public_key_here
-----END PUBLIC KEY-----

# Clerk domain
CLERK_DOMAIN_DEV=your-instance.clerk.accounts.dev
CLERK_DOMAIN_PROD=clerk.yourdomain.com

# Active domain (auto-selected based on ENVIRONMENT)
CLERK_DOMAIN=${CLERK_DOMAIN_DEV}

# Main SELVE API URLs (for toll gate verification)
MAIN_SELVE_API_URL_DEV=http://localhost:8000
MAIN_SELVE_API_URL_PROD=https://api.selve.me

# Active URL (auto-selected based on ENVIRONMENT)
MAIN_SELVE_API_URL=${MAIN_SELVE_API_URL_DEV}

# Internal API Secret (shared with main SELVE backend)
# Generate with: openssl rand -base64 32
INTERNAL_API_SECRET=your_shared_secret_here

# ==============================================================================
# LANGFUSE (LLM Observability & Cost Tracking)
# ==============================================================================
LANGFUSE_SECRET_KEY=
LANGFUSE_PUBLIC_KEY=
LANGFUSE_HOST=https://cloud.langfuse.com
LANGFUSE_ENABLED=true
LANGFUSE_RELEASE=${ENVIRONMENT}
LANGFUSE_TRACING_ENVIRONMENT=${ENVIRONMENT}

# OpenTelemetry Service Name (appears in Langfuse metadata as service.name)
OTEL_SERVICE_NAME=selve-chat-backend

# ==============================================================================
# GEOAPIFY (IP Geolocation for User Context)
# ==============================================================================
# Get API key from: https://myprojects.geoapify.com/
GEOAPIFY_API_KEY=your_geoapify_api_key_here
GEOAPIFY_ENABLED=true
GEOAPIFY_TIMEOUT=5

# ==============================================================================
# SERVER CONFIGURATION (Environment-based)
# ==============================================================================
PORT=9000
HOST=0.0.0.0
RELOAD=true

# CORS Origins
CORS_ORIGINS_DEV=http://localhost:4000,http://localhost:3000
CORS_ORIGINS_PROD=https://chat.selve.me,https://selve.me

# Active CORS origins (auto-selected based on ENVIRONMENT)
CORS_ORIGINS=${CORS_ORIGINS_DEV}
CORS_CREDENTIALS=true

# ==============================================================================
# LOGGING & MONITORING
# ==============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json

# ==============================================================================
# FEATURE FLAGS
# ==============================================================================
ENABLE_COMPRESSION=true
COMPRESSION_TRIGGER_THRESHOLD=0.7
ENABLE_EPISODIC_MEMORY=true
ENABLE_SEMANTIC_MEMORY=true
ENABLE_RAG=true
RAG_TOP_K=5

# Agentic pipeline toggles
SECURITY_GUARD_ENABLED=true
SECURITY_LLM_VERIFICATION_ENABLED=true
THINKING_ENGINE_ENABLED=true
RAG_ENABLED=true
WEB_SEARCH_ENABLED=false
YOUTUBE_SEARCH_ENABLED=false
RESPONSE_VALIDATION_ENABLED=true
AUTO_FIX_RESPONSES=true
USER_NOTES_ENABLED=true

# ==============================================================================
# RATE LIMITING
# ==============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_REQUESTS_PER_DAY=1000

# ==============================================================================
# DEVELOPMENT / DEBUGGING
# ==============================================================================
DEBUG=true
VERBOSE_LOGGING=false
ENABLE_API_DOCS=true

# ==============================================================================
# PRODUCTION DEPLOYMENT CHECKLIST
# ==============================================================================
# When deploying to production:
# 1. Change ENVIRONMENT=production (line 10)
# 2. Add all production API keys
# 3. Update database URLs
# 4. Update Clerk configuration
# 5. Set DEBUG=false and RELOAD=false
# 6. Verify CORS_ORIGINS_PROD
# 7. Copy this file to .env
# 8. Deploy and test toll gate authentication
